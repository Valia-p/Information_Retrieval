<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <title>Information Retrieval</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <header>
        <div class="headerText">
            <h1>Greek Parliament Information</h1>
        </div>
    </header>
    <div class="searchBar">
        <input type="search" placeholder="Search...">
        <button type="submit"><i class="fa fa-search"></i></button>
    </div>
    <div class="groupResults">

    </div>

    <div class="keywordSearchForm">
        <label>
            <select id="typeSelect">
                <option value="member">Βουλευτής</option>
                <option value="party">Κόμμα</option>
            </select>
        </label>
        <input type="text" id="nameInput" placeholder="π.χ. σκρεκας θεοδωρου κωνσταντινος">
        <button id="showKeywordsBtn" style="width:100px">Προβολή keywords ανά έτος</button>
    </div>

    <div class="keywordResults"></div>

<script>
    const searchButton = document.querySelector("button");
    const searchInput = document.querySelector("input[type='search']");
    const resultDiv = document.querySelector(".groupResults");

    const showKeywordsBtn = document.getElementById("showKeywordsBtn");
    const nameInput = document.getElementById("nameInput");
    const typeSelect = document.getElementById("typeSelect");
    const keywordResults = document.querySelector(".keywordResults");

    searchButton.addEventListener("click", () => {
        const query = searchInput.value;

        fetch("/search", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ query: query })
        })
        .then(response => response.json())
        .then(data => {
            resultDiv.innerHTML = "";
            if (data.length === 0) {
                resultDiv.innerHTML = "<p>No results found.</p>";
            } else {
                data.forEach(item => {
                    const div = document.createElement("div");
                    div.classList.add("result");
                    div.innerHTML = `
                        <h3>${item.member} (${item.party}) - ${item.date}</h3>
                        <p><strong>Score:</strong> ${item.score}</p>
                        <p>${item.speech}</p>
                    `;
                    resultDiv.appendChild(div);
                });
            }
        });
    });

        showKeywordsBtn.addEventListener("click", () => {
        const name = nameInput.value.trim().toLowerCase();
        const type = typeSelect.value;

        if (!name) {
            alert("Δώσε όνομα βουλευτή ή κόμματος.");
            return;
        }

        fetch("/keywords/by_year", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ type: type, name: name })
        })
        .then(response => response.json())
        .then(data => {
            keywordResults.innerHTML = "";
            if (data.error) {
                keywordResults.innerHTML = "<p>Δε βρέθηκαν δεδομένα.</p>";
                return;
            }

            for (const year in data) {
                const keywords = data[year].join(", ");
                const p = document.createElement("p");
                p.innerHTML = `<strong>${year}:</strong> ${keywords}`;
                keywordResults.appendChild(p);
            }
        });
    });
</script>
</body>
</html>
